## This is all very ad-hoc...

tarversion = 6

comp = user

repodir = testrepo
distsdir = $(repodir)/dists
certdir = $(distsdir)/cert
olddir = $(distsdir)/old
newdir = $(distsdir)/new
certpkgdir = $(certdir)/$(comp)/binary-all
oldpkgdir = $(olddir)/$(comp)/binary-all
newpkgdir = $(newdir)/$(comp)/binary-all

all:

repodirs:
	mkdir -p $(certpkgdir)
	mkdir -p $(oldpkgdir)
	mkdir -p $(newpkgdir)
	mkdir -p $(certdir)/$(comp)/binary-arm/
	mkdir -p $(olddir)/$(comp)/binary-arm/
	mkdir -p $(newdir)/$(comp)/binary-arm/
	mkdir -p $(certdir)/$(comp)/binary-i386/
	mkdir -p $(olddir)/$(comp)/binary-i386/
	mkdir -p $(newdir)/$(comp)/binary-i386/

binary-all-packages: repodirs
	./make-deb certified $(certpkgdir)
	./make-deb package-a1 $(oldpkgdir)
	./make-deb package-a2 $(newpkgdir)
	./make-deb package-b1 $(oldpkgdir)
	./make-deb package-b1 $(newpkgdir)
	./make-deb package-c1 $(oldpkgdir)
	./make-deb package-c1 $(newpkgdir)
	./make-deb package-d1 $(oldpkgdir)
	./make-deb package-d1 $(newpkgdir)
	./make-deb borken $(oldpkgdir)
	./make-deb borken $(newpkgdir)
	./make-deb corrupted-1 $(oldpkgdir)
	./make-deb corrupted-1 $(newpkgdir)
	./make-deb system $(oldpkgdir)
	./make-deb system $(newpkgdir)
	./make-deb user1 $(oldpkgdir)
	./make-deb user1 $(newpkgdir)
	./make-deb user2 $(oldpkgdir)
	./make-deb user2 $(newpkgdir)
	./make-deb sized-5k $(oldpkgdir)
	./make-deb sized-50k $(oldpkgdir)
	./make-deb sized-500k $(oldpkgdir)
	./make-deb sized-5M $(oldpkgdir)
	./make-deb sized-50M $(oldpkgdir)
	./make-deb sized-500M $(oldpkgdir)
	./make-deb sized-1500M $(oldpkgdir)
	./make-deb sized-3G $(oldpkgdir)
	cp ../licensed_2_all.deb $(olddir)/$(comp)/binary-all/
	cp ../licensed_2_all.deb $(newdir)/$(comp)/binary-all/
	cp ../big_2_all.deb $(olddir)/$(comp)/binary-all/

binary-arm-packages:
	cp ../package-1_2_arm.deb $(olddir)/$(comp)/binary-arm/
	cp ../package-1_2_arm.deb $(newdir)/$(comp)/binary-arm/
	cp ../package-2_2_arm.deb $(olddir)/$(comp)/binary-arm/
	cp ../package-2_2_arm.deb $(newdir)/$(comp)/binary-arm/

binary-i386-packages:
	cp ../package-1_2_i386.deb $(olddir)/$(comp)/binary-i386/
	cp ../package-1_2_i386.deb $(newdir)/$(comp)/binary-i386/
	cp ../package-2_2_i386.deb $(olddir)/$(comp)/binary-i386/
	cp ../package-2_2_i386.deb $(newdir)/$(comp)/binary-i386/

binary-packages: binary-all-packages binary-arm-packages binary-i386-packages

conf-packages:
	./make-deb testrepo-conf-mmc $(repodir)
	./make-deb testrepo-conf-maemo $(repodir)
	./make-deb testrepo-conf-drpepper $(repodir)

update-repo:
	./update-dist testrepo cert $(comp)
	./update-dist testrepo old $(comp)
	./update-dist testrepo new $(comp)
	cp Makefile.repo $(oldpkgdir)/corrupted_1_all.deb
	cp Makefile.repo $(newpkgdir)/corrupted_1_all.deb

tar: clean-repo
	tar czf $(repodir)-$(tarversion).tar.gz $(repodir)

clean:
	rm -rf $(repodir)

clean-repo:
	$(MAKE) -f Makefile.repo clean
	$(MAKE) -f Makefile.repo binary-packages
	$(MAKE) -f Makefile.repo conf-packages
	$(MAKE) -f Makefile.repo update-repo

sync-mylly:
	# mylly doesn't have rsync, there should be a law against that...
	ssh mylly rm -rf /home/mvo/public-html/testrepo/
	scp -r testrepo mylly:/home/mvo/public-html/

sync-maemo:
	rsync -v --delete -essh -a testrepo guest@drpepper.research.nokia.com:
	rsync -v --delete -essh -a testrepo guest@drpepper.research.nokia.com:public_html/
