dnl Process this file with autoconf to produce a configure script.
AC_PREREQ(2.52)
 
AC_INIT(libossomime, 1.8.5)
AC_CONFIG_SRCDIR(libossomime/osso-uri.c)
AM_INIT_AUTOMAKE(AC_PACKAGE_NAME, AC_PACKAGE_VERSION)

dnl Versioning for libossomime

dnl Increase when changing the API (adding, removing, changing)
LIBOSSOMIME_CURRENT=1

dnl Increase when changing implementation of current API,
dnl reset to 0 when changing CURRENT. This is the revision of current
dnl API version.
LIBOSSOMIME_REVISION=3

dnl Change this only if CURRENT has been changed. Increase if API
dnl change is ABI compatible, otherwise reset to 0
LIBOSSOMIME_AGE=1

LIBOSSOMIME_VERSION_INFO="$LIBOSSOMIME_CURRENT:$LIBOSSOMIME_REVISION:$LIBOSSOMIME_AGE"
AC_SUBST(LIBOSSOMIME_VERSION_INFO)

dnl Globally define_GNU_SOURCE and therefore enable the GNU extensions
AC_DEFINE(_GNU_SOURCE, 1, [Enable GNU Extensions])

AM_MAINTAINER_MODE
AM_CONFIG_HEADER(config.h)

AM_DISABLE_STATIC
AM_PROG_LIBTOOL

AC_ISC_POSIX
AC_PROG_CC
AM_PROG_CC_STDC
AC_HEADER_STDC

AC_HEADER_TIME
AC_CHECK_HEADERS([stdlib.h string.h])

dnl Defined in acinclude.m4
IDT_COMPILE_WARNINGS

GNOME_VFS_REQUIRED=2.16.3
DBUS_REQUIRED=0.60
GLIB_REQUIRED=2.6.0
GTK_REQUIRED=2.6.0
LIBXML_REQUIRED=2.4

dnl =======================================
dnl libossomime
dnl =======================================
PKG_CHECK_MODULES(LIBOSSOMIME, [
        glib-2.0 >= $GLIB_REQUIRED
        gnome-vfs-2.0 >= $GNOME_VFS_REQUIRED
        gnome-vfs-module-2.0 >= $GNOME_VFS_REQUIRED
        dbus-glib-1 >= $DBUS_REQUIRED
])

AC_SUBST(LIBOSSOMIME_CFLAGS)
AC_SUBST(LIBOSSOMIME_LIBS)

dnl =======================================
dnl update-category-database 
dnl =======================================
PKG_CHECK_MODULES(UPDATE_CATEGORY, [
        glib-2.0 >= $GLIB_REQUIRED
        libxml-2.0 >= $LIBXML_REQUIRED
])
AC_SUBST(UPDATE_CATEGORY_CFLAGS)
AC_SUBST(UPDATE_CATEGORY_LIBS)

AC_ARG_ENABLE(update-categorydb,
   AC_HELP_STRING([--disable-update-categoryb],
                   [disable the update-category-database after install [default=no]]),,
    enable_update_categorydb=yes)
AM_CONDITIONAL(ENABLE_UPDATE_CATEGORYDB, test x$enable_update_categorydb = xyes)


dnl This will cause the automake generated makefiles to pass the
dnl correct flags to aclocal.
ACLOCAL_AMFLAGS="\${ACLOCAL_FLAGS}"
AC_SUBST(ACLOCAL_AMFLAGS)

AC_OUTPUT([
	Makefile 
	libossomime.pc
	debian/Makefile
        libossomime/Makefile
        tests/Makefile
        data/Makefile
	docs/Makefile
])
