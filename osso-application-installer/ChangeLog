2005-08-09  Marius Vollmer  <marius.vollmer@nokia.com>

	* src/ui/represent.c, src/ui/represent.h (all_white_space):
	Advance pointer in loop, stupid.
	(present_error_details): New.
	(present_report_with_details): Redone as a two stage process:
	first show the report as a information or confirmation note, and
	then the details in a second dialog (XXX-UI32).
	
	* src/core.h, src/core.c: Do not use gettext for strings not in
	the UI spec (XXX-UI32).
	(package_file_info): Made static.  Do not present any details when
	failing (XXX-UI32).
	(run_app_installer_tool): Append a hardcoded "See the details?"
	to error description (XXX-UI32).
	(list_packages): Ignore broken packages (XXX-UI32).
	(format_relationship_failures): Return a gchar* instead of a
	GString.  The extra text is now the footer, not the header.
	Changed all callers.
	(installer_data): Added dont_show_details field.
	(installer_callback): Suppress details in case of success and when
	explicitely requested.  Relationship failures are now part of the
	error details, not of the report (XXX-UI32).
	(check_dependencies): New.
	(uninstall_package): Use it to catch dependency errors early.  Use
	the dont_show_details field to suppress any error details
	(XXX-UI32).

	* src/ui/interface.c: Do not use gettext for strings not in the UI
	spec (XXX-UI32).
	(ui_create_progress_dialog): Ignore the cancel_callback
	(XXX-UI32).  Remove Cancel button from progress bar dialog when it
	is not needed.
	
	* app-installer-tool/app-installer-tool.c (do_get_dependencies):
	New.

2005-08-03  Marius Vollmer  <marius.vollmer@nokia.com>

	Released version 2.4-0.

	* configure.ac: Changed version for release.
	
	* src/core.c (install_package_from_uri): use
	gnome_vfs_unescape_string to decode stuff like '%20'.

2005-08-02  Marius Vollmer  <marius.vollmer@nokia.com>

	Throughout: changed logical l10n strings that are not in version
	3.1 of the UI spec to their English translations.
	
	* src/core.c, src/core.h (spawn_app_installer_tool): Return a
	handle.  Changed all callers to free it.
	(free_app_installer_tool): New, for freeing it.
	(cancel_app_installer_tool): New.
	(installer_cancel): New.
	(installer_progress): Use it with the progress dialog.

	* src/ui/interface.h, src/ui/interface.c (progress_dialog,
	ui_create_progress_dialog): Added cancel_callback.

	* src/appdata.h (AppUIData): Renamed database_corrupted_label to
	database_unavailable_label.  Changed all uses.

2005-07-28  Marius Vollmer  <marius.vollmer@nokia.com>

        Released 2.2-0.
	
	* src/core.c (read_into_string): Use read syscall instead of
	g_io_channel_read_chars since the latter blocks sometimes.  Needs
	more investigation.
	(kb_used_in_var_lib_install): Use statvfs instead of spawning
	"du".  The latter fails surprisingly often.

	* src/ui/interface.h (progress_dialog,
	ui_create_progressbar_dialog, ui_close_progress_dialog,
	ui_set_progress_dialog): New.
	* core.c (installer_callback, installer_progress): Use it, but
	only in the pulsing mode.

	* src/ui/callbacks.h, src/ui/callbacks.c (do_install): New.
	(on_button_install_clicked): Use it.
	* src/dbus.c (dbus_message_handler): Likewise.
	* src/main.c (main): Likewise.
	
2005-07-27  Marius Vollmer  <marius.vollmer@nokia.com>

	* configure.ac: Bumped version to 2.1.
	(AITOOLS_CFLAGS, AITOOLS_LIBS): Added gnome-vfs-2.0.
	
	* app-installer-tool/app-installer-tool.c (do_copy): New.

	* src/core.c (run_app_installer_tool): Reimplemented by using
	spawn_app_installer_tool.
	(spawn_app_installer_tool): Take three args for
	app-installer-tool.  Make using sudo optional.  Accept 'line'
	callbacks.  Changed all callers.
	(read_into_string): Call 'line' callbacks as appropriate.
	(kb_used_in_var_lib_install): Log error message in case of
	failure.
	(installer_progress): Deal with errors from
	kb_used_in_var_lib_install.
	(install_package_from_uri): New.

	* src/dbus.c (dbus_message_handler): Use install_package_from_uri
	instead of on_button_install_clicked.
	
	* src/main.c (main): Call install_package_from_uri instead of
	passing it inside app_ui_data.

	* src/ui/callbacks.c (on_button_install_clicked): Use
	install_package_from_uri instead of doing the copying here.  Do
	not look at 'param' from app_ui_data.
	
2005-07-22  Marius Vollmer  <marius.vollmer@nokia.com>

	* Makefile.am (SUBDIRS): Removed wrapper.
	* configure.ac: Do not create wrapper/Makefile.

	* src/ui/interface.c (ui_create_main_dialog): Do not use
	"row-activated" signal of treeview, use "changed" signal of its
	selection.

	* src/ui/callbacks.h, src/ui/callbacks.c (on_treeview_activated):
	Renamed to on_treeview_selection_changed and adapted to be useable
	as a "changed" signal handler for the tree selection.

	
	First round of the big rewrite.  Main things missing: context
	sensitive menu and direct installation from command line argument.
	
	* configure.ac: Changed version to 2.0-0.  Handle
	"--disable-sudo".  Check for the depencies of app-installer-tool.

	* src/core.c, src/core.h: Rewritten, changed everything.

	* src/ui/represent.h, src/ui/represent.c: Removed unused defines.
	(represent_packages): Renamed to update_package_list.  Take
	AppData instead of AppUIData.  Changed all callers.  Deal with
	errors from list_packages.
	(represent_confirmation, represent_dependencies, represent_error,
	represent_notification, show_dialog): Removed.
	(present_report_with_details, confirm_install, confirm_uninstall):
	New.
	
	* src/ui/interface.h, src/ui/interface.c: Removed unused defines.
	(ui_freeze_column_sizes, ui_show_notification, ui_set_progressbar,
	ui_pulse_progressbar, ui_create_progressbar_dialog,
	ui_cleanup_progressbar_dialog): Removed.
	(ui_read_selected_package): Also return size.  Do not test for
	special entries to ignore, they are not used anymore.
	(ui_create_main_dialog): Create database_corrupted_label.  Only
	update list of apckages after everything has been created.  This
	allows the list updating to display errors.  Do not set textbuffer
	to MESSAGE_DOUBLECLICK, whatever that was meant to be.  Removed
	code for doing direct install.
	
	* src/ui/callbacks.c, src/ui/callbacks.h (on_treeview_activated):
	Use AppData instead of AppUIData.  Changed all callers.
	(on_button_install_clicked): Only test for "file://" method whend
	deciding whether to copy the file or not.  See the source for a
	rationale.

	* src/main.c (main): Temporarily disabled direct installation.

	* src/definitions.h: Removed unused defines.

	* src/appdata.h (AppUIData): Removed builtin_packages, added
	database_corrupted_label.

	* Makefile.am (SUBDIRS): Added app-installer-tool.

	* app-installer-tool/app-installer-tool.c: Added prototypes.
	Expanded usage message.
	(setup_environment): Set "LC_ALL" instead of "LANG".
	(do_list): Use "--showformat" instaed of "-f" since the latter is
	not supported by the dpkg-query on the target.
	(do_describe_package): Likewise.
	(parse_field): New.
	(do_describe_file): Use it to provide package name, version and
	size in addition to description.
	(do_install): Run dpkg with fakeroot.  Removed "--log",
	"--force-not-root" and "--force-bad-path" options accordingly.
	(do_uninstall): Likewise.
	(do_install): Return 1, not -1, when the package exists.
	(do_env): Removed.

	* maemo.control: Changed version to 1.0.

2005-07-21  Marius Vollmer  <marius.vollmer@nokia.com>

	* autogen.sh: Use "--copy --force" also with libtoolize and
	"--copy" with autoconf to avoid symlinks in the source tree.

2005-07-19  Marius Vollmer  <marius.vollmer@nokia.com>

	* app-installer-tool/Makefile.am,
	app-installer-tool/app-installer-tool.c: New.

2005-07-19  Marius Vollmer  <marius.vollmer@nokia.com>

	Released version 1.0.29-0.

	* configure.ac: Increased version number.
	* make-package: Use "-uc -us -sa -D" options for
	dpkg-buildpackage.

2005-07-18  Marius Vollmer  <marius.vollmer@nokia.com>

	* maemo.control, maemo.dirs: New files, for building the maemo.deb
	package.
	
	* Makefile.am: Build and install the maemo.deb package.
	(install-data-local, dist-hook): Removed since /var/lib/install is
	now created by postinst.
	(EXTRA_DIST): Added maemo.control and maemo.dirs.
	
	* make-package: Expect location of debian/ directory as argument.
	* Makefile.am (DEBIAN, deb): Provide it, in an overridable way.

	* src/Makefile.am (script_DATA): Do not use $(srcdir) here.
	(EXTRA_DIST): New, since script_DATA is not distributed
	automatically.

2005-07-14  Marius Vollmer  <marius.vollmer@nokia.com>

	* make-package: New.
	
	* Makefile.am (deb): Replaced with call to make-package.
	(dist-hook): New, to include data/ in distribution.
	(install-data-local): New, to create /var/lib/install
	
2005-07-13  Marius Vollmer  <marius.vollmer@nokia.com>

	* Makefile.am, src/Makefile.am (DISTCLEANFILES): Added so that
	files created by configure get deleted by "make distclean".

	* src/Makefile.am (script_DATA): Get the files from $(srcdir) to
	enable a VPATH build.

	* control-panel/Makefile.am (CLEANFILES, DISTCLEANFILES): Moved
	.desktop files to DISTCLEANFILES since they are created by
	configure.

	* Imported version 1.0.28 into public repository.
