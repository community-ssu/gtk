#!/bin/bash

# Umm, not needed after all?

# Script to build a libtool compatible object with export records.
# This is necessary because gcc and/or ld don't generate export
# entries for .exes even if you use __declspec(dllexport) for the
# functions, unless you use dlltool --output-exp.

# The command line arguments are: $1: the name of the export libtool
# object file to produce $2... the names of the object files to scan
# with dlltool.

lo=$1
shift
for object; do
    case $object in
    *.o)
	objs="$objs $object"
	;;
    esac
done

expfile=.libs/`basename $lo .lo`.exp

dlltool --output-exp $expfile $objs

# Handcraft a libtool object
# libtool checks for a second line matching "Generated by .* libtool"!
(echo "# $lo"
echo "# Generated by lt-build-exp, compatible with libtool"
echo "pic_object=$expfile"
echo "non_pic_object=none") >$lo

# Success
exit 0
