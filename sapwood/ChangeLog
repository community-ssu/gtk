2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c (theme_pixbuf_render): Trap X errors to avoid
	BadAlloc when trying to allocate *huge* bitmaps (600x33000 GtkFrame
	in a viewport) NB#35602

2006-10-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/Makefile.am (libsapwood_la_CFLAGS): Added to define G_LOG_DOMAIN

2006-06-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.24 ===

	* src/sapwood-server.c (pixbuf_open_response_destroy): Don't crash on
	NULL, it's a valid parameter when image loading fails.
	(process_buffer): Failure to load an image is not a client error, do
	not disconnect the client.
	N#32525

2006-05-12  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.19 ===

2006-05-10  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h (theme_pixbuf_render): Return FALSE when
	rendering fails for any reason
	* src/sapwood-draw.c (draw_simple_image): If rendering fails, do not
	apply window shape mask as it's most likely garbage
	* src/sapwood-render.c (pixmap_cache_value_new,
	theme_pixbuf_get_pixmap, theme_pixbuf_render): Do not exit, only warn
	and return error code, if pixmaps can not be loaded (someone removed
	the theme in use?)
	N#26863

2006-05-10  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.18 ===

2006-04-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-rc-style.c (theme_parse_image): Use g_new0 rather than
	g_malloc to make sure fields are initialized.
	* src/sapwood-pixmap.c (sapwood_pixmap_get_for_file): Initialize the
	buffer to silence valgrind.
	N#27967

2006-04-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_focus): Use state parameter when matching
	images for focus to allow more flexible, state-dependent focus
	theming. N#23070

2006-04-24  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.17 ===
	
	* src/sapwood-pixmap.c(sapwood_pixmap_free): Do not unref NULL mask.
	N#27515

2006-04-12  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* === Release 2.14.1 ===

	* src/*.c: #include <config.h> to get configure settings correctly...
	Duh! N#26389

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 2.14 ===

	* configure.in
	* NEWS: Updated

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Makefile.am (MAINTAINERCLEANFILES): Add compile and depcomp.
	* src/Makefile.am (sapwood_server_CFLAGS): Add dummy cflags to work
	with newer autotools.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c (sapwood_pixmap_render_rects): Use clip mask
	only if one was drawn using the tile masks from theme.
	* src/sapwood-server.c (extract_pixmap_single): Create masks only for
	pixbufs with alpha.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (draw_simple_image, get_window_for_shape): Use
	flag from gtkrc to figure out need for shape mask.
	* src/sapwood-rc-style.c (theme_symbols, theme_parse_shaped,
	theme_parse_image): Add 'shaped' (default=FALSE) token to explicitly
	enable support for shaped windows from gtkrc.
	* src/theme-pixbuf.h (ThemeImage): Trade one bit from 'refcount' to
	hold the value for TOKEN_SHAPED (replaces unused TOKEN_RECOLORABLE) in
	'background_shaped' member.

2006-04-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c (get_window_for_shape, draw_simple_image):
	Refactor shape mask requirement logic into separate function.

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.36 ===

	* configure.in
	* NEWS: Updated

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h: restore TOKEN_RECOLORABLE for not to invalidate
	gtkrc cache files

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h(struct _ThemePixbuf, struct _ThemeMatchData):
	reorder and turn various members into bitfiels and save another 12k.

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/theme-pixbuf.h(struct _ThemePixbuf)
	* src/sapwood-render.c(theme_pixbuf_copy, theme_pixbuf_hash,
	theme_pixbuf_equal, theme_pixbuf_set_filename,
	pixmap_cache_value_new): split (absolute) filename to dirname and
	basename, keep only canonicalized copy in memory and reconstruct the
	absolute filename when needed.  Saves roughly 21k (out of 43k) memory.
	N#16158

2005-09-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h(struct _ThemeImage)
	* src/sapwood-rc-style.c(theme_symbols, theme_parse_image): remove
	unused 'recolorable' token

2005-05-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.22 ===

	* configure.in
	* NEWS: Updated

2005-05-27  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw(draw_extension): Stop expanding our designated
	drawing area, it's just wrong, wrong, wrong (#9727)

2005-05-18  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw(render_icon): Increase alpha of the background
	colored pixels used when dimming icons to avoid extreme contrast.

2005-05-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.20 ===

	* configure.in
	* NEWS: Updated

2005-05-13  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c(sapwood_pixmap_free): Make sure all (XChangeGC)
	operations are processed before letting the sapwood server free the
	pixmaps.  Otherwise there's a risk of getting BadPixmap errors (#11906)

2005-05-03  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.18.1 ===

	* configure.in
	* NEWS: Updated

2005-05-02  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-draw.c: Dim icons by drawing a simple background color
	(white) raster over the normal state icon.

	* configure.in
	* src/sapwood-server.c
	* src/Makefile.am: Remove unneeded gtk+ dependency from
	sapwood-server.

2005-04-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.18 ===

	* configure.in
	* NEWS: Updated

2005-04-26  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Change ref/unref to open/close to match
	protocol semantics.

2005-04-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/sapwood-render.c(theme_pixbuf_equal): Fix border equality
	check warnings, compare right to right, not right to bottom.

	* src/sapwood-render.c(theme_pixbuf_get_pixmap): theme_pixbuf_ref() has
	invalid semantics for GCache use (results in memory leak due to
	self-referencing.)  Introduce and use theme_pixbuf_copy() instead.
	* src/sapwood-render.c(theme_pixbuf_ref): Removed.

	* src/sapwood-pixmap.c: Generalize pixbuf_proto_get_pixmap() to
	pixbuf_proto_request() which can handle arbitrary requests and
	optional responses. 

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Rename PixbufRequest,PixbufResponse to
	PixbufRefRequest,PixbufRefResponse

	* src/sapwood-rc-style.c: Check all images for missing filenames
	instead of only 'background' and 'overlay' ('gap', 'gap_start',
	'gap_end' were missing.)

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Include request total length in the message to
	make trivial validation possible.

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Include opcode in the request message.

	* src/sapwood-server.c: Don't assume a read from the socket is a
	single whole request, be prepared for partial and multiple requests in
	the buffer.

	* src/sapwood-server.c
	* src/sapwood-proto.h: Assign a handle for each client requested image
	the client can use later to release the image.

	* src/sapwood-pixmap.c
	* src/sapwood-server.c
	* src/sapwood-proto.h: Add unref request to the protocol and release
	images from the client side.

2005-03-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/Makefile.am: Move sapwood server to $(libdir)/sapwood, this is
	not gtk-engines package anymore.

2005-03-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* configure.in: Check for abstract socket namespace
	* src/sapwood-pixmap.c
	* src/sapwood-server.c: Use abstract socket namespace if available to
	avoid leaving dangling sockets in the filesystem

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* === Release 1.08 ===

	* configure.in
	* NEWS: Updated

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>
	
	* src/sapwood-server.c(client_sock_callback): Remove unused variable.

2005-02-23  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* src/theme-pixbuf.h
	* src/sapwood-render.c: Switch visibility of theme_pixbuf_unref()
	and theme_pixbuf_destroy()
	* src/sapwood-rc-style.c: Always unref pixbufs rather than blindly
	destroying them.  Avoids crashing on theme change (#5533)

2004-12-21  Tommi Komulainen  <tommi.komulainen@nokia.com>

	* Creating new package by extracting (greatly modified) pixbuf engine
	from gtk-engines.

