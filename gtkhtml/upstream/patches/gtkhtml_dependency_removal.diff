# Dependency removal patch
#
# Copyright (C) 2006 Nokia Corporation.
# This file is distributed under the terms of GNU LGPL license version 2.1
#
diff -Nru gtkhtml-3.9.1/config.h.in gtkhtml-3.9.1-djcb/config.h.in
--- gtkhtml-3.9.1/config.h.in	2005-10-25 12:41:31.000000000 +0300
+++ gtkhtml-3.9.1-djcb/config.h.in	2005-11-09 19:28:35.000000000 +0200
@@ -25,6 +25,8 @@
 #undef GTKHTML_RELEASE_STRING
 #undef HAVE_OLD_SOUP
 
+#undef DISABLE_PRINTING
+#undef DISABLE_GNOME
 
 /* Editor API Version */
 #undef EDITOR_API_VERSION
diff -Nru gtkhtml-3.9.1/configure.in gtkhtml-3.9.1-djcb/configure.in
--- gtkhtml-3.9.1/configure.in	2005-10-25 12:03:22.000000000 +0300
+++ gtkhtml-3.9.1-djcb/configure.in	2005-11-11 12:32:08.000000000 +0200
@@ -5,6 +5,8 @@
 
 PACKAGE=gtkhtml
 
+AC_PROG_MAKE_SET
+
 GTKHTML_API_VERSION=3.8
 AC_DEFINE_UNQUOTED(GTKHTML_API_VERSION, "${GTKHTML_API_VERSION}", [GtkHTML API Version])
 AC_SUBST(GTKHTML_API_VERSION)
@@ -56,8 +58,8 @@
 AM_CONDITIONAL(OS_WIN32, [test $os_win32 = yes])
 AC_SUBST(SOEXT)
 
-GNOME_COMPILE_WARNINGS(yes)
-CFLAGS="$CFLAGS $warning_flags"
+dnl GNOME_COMPILE_WARNINGS(yes)
+dnl CFLAGS="$CFLAGS $warning_flags"
 
 AC_SUBST(CFLAGS)
 AC_SUBST(CPPFLAGS)
@@ -66,13 +68,83 @@
 ALL_LINGUAS="am ar az be bg bn ca cs cy da de el en_CA en_GB es et eu fa fi fr ga gl gu he hi hr hu id it ja ko lt lv mk ml ms nb ne nl nn no pa pl pt pt_BR ro ru rw sk sl sq sr sr@Latn sv ta tr uk vi xh zh_CN zh_TW"
 AM_GLIB_GNU_GETTEXT
 
-GAIL_MODULES="gail >= 1.1.0"
-PKG_CHECK_MODULES(GAIL, $GAIL_MODULES)
-AC_SUBST(GAIL_CFLAGS)
-AC_SUBST(GAIL_LIBS)
-AC_SUBST(GAIL_MODULES)
 
-GTKHTML_MODULES="libgnomeui-2.0 >= 2.0.0 libgnomeprintui-2.2 >= 2.2.1 libglade-2.0 >= 2.0.0"
+dnl
+dnl do we want a11y support?
+dnl
+GAIL_MODULES=""
+AC_ARG_ENABLE(a11y,
+	      [ --enable-a11y	Enable Accessibility (requires gail) [default=yes]],
+	      [ac_cv_enable_a11y=$enableval],[ac_cv_enable_a11y=yes])
+AC_MSG_CHECKING([whether to enable a11y])
+if test "$ac_cv_enable_a11y" = yes; then
+	AC_MSG_RESULT(yes)
+	GAIL_MODULES="gail >= 1.1.0"
+	PKG_CHECK_MODULES(GAIL, $GAIL_MODULES)
+	AC_SUBST(GAIL_CFLAGS)
+	AC_SUBST(GAIL_LIBS)
+	AC_SUBST(GAIL_MODULES)
+	A11Y_DIR="a11y"
+	AC_SUBST(A11Y_DIR)
+	A11Y_LA="../a11y/libgtkhtml-a11y.la"
+	AC_SUBST(A11Y_LA)
+else
+	AC_MSG_RESULT(no)
+	AC_DEFINE(DISABLE_A11Y)
+	CFLAGS="-DDISABLE_A11Y $CFLAGS"
+	PC_CFLAGS="-DDISABLE_A11Y $PC_CFLAGS"
+fi
+
+
+dnl
+dnl do we want printing support?
+dnl
+GNOMEPRINT_MODULES=""
+AC_ARG_ENABLE(printing,
+	      [ --enable-printing Enable Printing (requires gnome-print) [default=yes]],
+	      [ac_cv_enable_printing=$enableval],[ac_cv_enable_printing=yes])
+AC_MSG_CHECKING([whether to enable printing])
+if test "$ac_cv_enable_printing" = yes; then
+	AC_MSG_RESULT(yes)
+	GNOMEPRINT_MODULES="libgnomeprintui-2.2 >= 2.2.1"
+	GNOME_TEST_PROGRAMS="gtest test-suite test-stress"
+else
+	AC_MSG_RESULT(no)
+	AC_DEFINE(DISABLE_PRINTING)
+	CFLAGS="-DDISABLE_PRINTING $CFLAGS"
+	PC_CFLAGS="-DDISABLE_PRINTING $PC_CFLAGS"
+fi
+AM_CONDITIONAL(HAVE_PRINTING, test x$ac_cv_enable_printing != xno)
+
+
+dnl
+dnl do we want gnome support?
+dnl
+GNOME_MODULES=""
+AC_ARG_ENABLE(gnome,
+	      [ --enable-gnome Enable Gnome  (requires many things) [default=yes]],
+	      [ac_cv_enable_gnome=$enableval],[ac_cv_enable_gnome=yes])
+AC_MSG_CHECKING([whether to enable gnome])
+if test "$ac_cv_enable_gnome" = yes; then
+	AC_MSG_RESULT(yes)
+	GNOME_MODULES="libgnomeui-2.0 >= 2.0.0"
+
+	dnl **************************************************
+	dnl * Gnome Icon Theme
+	dnl **************************************************
+	PKG_CHECK_MODULES(GIT, gnome-icon-theme >= 1.2.0)
+else
+	GNOME_MODULES=""
+	AC_MSG_RESULT(no)
+	AC_DEFINE(DISABLE_GNOME)
+	CFLAGS="-DDISABLE_GNOME $CFLAGS"
+	PC_CFLAGS="-DDISABLE_GNOME $PC_CFLAGS"
+fi
+
+
+dnl libglade only needed on windows?
+dnl GTKHTML_MODULES="$GNOME_MODULES $GNOMEPRINT_MODULES $GAIL_MODULES libglade-2.0 >= 2.0.0"
+GTKHTML_MODULES="$GNOME_MODULES $GNOMEPRINT_MODULES $GAIL_MODULES gtk+-2.0 >= 2.6.0 gconf-2.0 libart-2.0 >= 2.3.0"
 PKG_CHECK_MODULES(GTKHTML, $GTKHTML_MODULES)
 AC_SUBST(GTKHTML_CFLAGS)
 AC_SUBST(GTKHTML_LIBS)
@@ -83,16 +155,38 @@
 	AC_DEFINE([PANGO_1_5_OR_HIGHER], [], [Means that Pango 1.5 or higher is available])
 fi
 
-EDITOR_MODULES="${GTKHTML_MODULES} libbonoboui-2.0 >= 2.2.4"
-PKG_CHECK_MODULES(EDITOR, $EDITOR_MODULES)
-AC_SUBST(EDITOR_CFLAGS)
-AC_SUBST(EDITOR_LIBS)
 
-ORBIT_IDL="`$PKG_CONFIG --variable=orbit_idl ORBit-2.0`"
-AC_SUBST(ORBIT_IDL)
+dnl
+dnl do we want the editor module?
+dnl 
+EDITOR_MODULES=""
+AC_ARG_ENABLE(editor,
+	      [ --enable-editor Enable Editor  (requires many things) [default=yes]],
+	      [ac_cv_enable_editor=$enableval],[ac_cv_enable_editor=yes])
+AC_MSG_CHECKING([whether to enable editor])
+if test "$ac_cv_enable_editor" = yes; then
+	AC_MSG_RESULT(yes)
+	EDITOR_MODULES="${GTKHTML_MODULES} libgnomeui-2.0 >= 2.0.0 libbonoboui-2.0 >= 2.2.4"
+	PKG_CHECK_MODULES(EDITOR, $EDITOR_MODULES)
+	AC_SUBST(EDITOR_CFLAGS)
+	AC_SUBST(EDITOR_LIBS)
+
+	ORBIT_IDL="`$PKG_CONFIG --variable=orbit_idl ORBit-2.0`"
+	AC_SUBST(ORBIT_IDL)
+
+	BONOBO_IDL_INCLUDES="-I`$PKG_CONFIG --variable=idldir libbonobo-2.0` -I`$PKG_CONFIG --variable=idldir bonobo-activation-2.0`"
+	AC_SUBST(BONOBO_IDL_INCLUDES)
+
+	EDITOR_DIR="components"
+	AC_SUBST(EDITOR_DIR)
+else
+	AC_MSG_RESULT(no)
+	AC_DEFINE(DISABLE_EDITOR)
+fi
+
+
+
 
-BONOBO_IDL_INCLUDES="-I`$PKG_CONFIG --variable=idldir libbonobo-2.0` -I`$PKG_CONFIG --variable=idldir bonobo-activation-2.0`"
-AC_SUBST(BONOBO_IDL_INCLUDES)
 
 dnl **********************************
 dnl soup for testgtkhtml
@@ -119,11 +213,6 @@
 fi
 
 dnl **************************************************
-dnl * Gnome Icon Theme
-dnl **************************************************
-PKG_CHECK_MODULES(GIT, gnome-icon-theme >= 1.2.0)
-
-dnl **************************************************
 dnl * regex library
 dnl **************************************************
 AC_CHECK_FUNCS(regexec,,[AC_CHECK_LIB(regex,regexec,[REGEX_LIBS=-lregex],[AC_MSG_ERROR([No regex library found])])])
@@ -167,6 +256,8 @@
 AC_SUBST(GTKHTML_REVISION)
 AC_SUBST(GTKHTML_AGE)
 
+AC_SUBST(PC_CFLAGS)
+
 dnl **************
 dnl Done.
 dnl **************
@@ -184,9 +275,15 @@
 art/Makefile
 ])
 
+
 echo "
 
 Configuration:
-
+	
+	accessibility support:		$ac_cv_enable_a11y
+	gnome-print support:            $ac_cv_enable_printing
+	gnome support:			$ac_cv_enable_gnome
+	editor component:               $ac_cv_enable_editor	
+		
 	Editor component type:		${GNOME_GTKHTML_EDITOR_TYPE}
 "
diff -Nru gtkhtml-3.9.1/Makefile.am gtkhtml-3.9.1-djcb/Makefile.am
--- gtkhtml-3.9.1/Makefile.am	2005-09-05 10:48:29.000000000 +0300
+++ gtkhtml-3.9.1-djcb/Makefile.am	2005-11-09 19:22:58.000000000 +0200
@@ -1,9 +1,9 @@
-SUBDIRS =					\
-	a11y					\
-	src					\
-	components				\
-	art					\
-	po
+SUBDIRS =                                       \
+        $(A11Y_DIR)                             \
+        src                                     \
+        $(EDITOR_DIR)                           \
+        art                                     \
+        po
 
 CLEANFILES =					\
 	po/.intltool-merge-cache
diff -Nru gtkhtml-3.9.1/src/gtkhtml.c gtkhtml-3.9.1-djcb/src/gtkhtml.c
--- gtkhtml-3.9.1/src/gtkhtml.c	2005-09-11 07:24:32.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/gtkhtml.c	2005-11-10 20:41:35.000000000 +0200
@@ -30,9 +30,14 @@
 #include <glib/gi18n-lib.h>
 #include <string.h>
 
+#ifndef DISABLE_GNOME
 #include <gnome.h>
+#include <libgnome/gnome-util.h>
+#endif /*DISABLE_GNOME*/
 
+#ifndef DISABLE_A11Y
 #include "../a11y/factory.h"
+#endif /*DISABLE_A11Y*/
 
 #include "htmlcolorset.h"
 #include "htmlcluev.h"
@@ -73,7 +78,6 @@
 #include "gtkhtml-private.h"
 #include "gtkhtml-properties.h"
 #include "math.h"
-#include <libgnome/gnome-util.h>
 
 enum DndTargetType {
 	DND_TARGET_TYPE_MESSAGE_RFC822,
@@ -3102,8 +3106,10 @@
 	html_class->command           = command;
 
 	add_bindings (klass);
+#ifndef DISABLE_A11Y
 	gtk_html_accessibility_init ();
-
+#endif /*DISABLE_A11Y*/
+	
 	filename = g_build_filename (PREFIX, "share", GTKHTML_RELEASE_STRING, "keybindingsrc.emacs", NULL);
 	gtk_rc_parse (filename);
 	g_free (filename);
@@ -4086,6 +4092,7 @@
 
 
 /* Printing.  */
+#ifndef DISABLE_PRINTING
 
 void
 gtk_html_print (GtkHTML *html,
@@ -4109,6 +4116,7 @@
 					      header_height, footer_height, header_print, footer_print, user_data);
 }
 
+#endif /*DISABLE_PRINTING*/
 
 /* Editing.  */
 
@@ -5739,12 +5747,21 @@
 	return html->engine->allow_frameset;	
 }
 
+#ifndef DISABLE_PRINTING
 void
 gtk_html_print_set_master (GtkHTML *html, GnomePrintJob *print_master)
 {
 	html->priv->print_master = print_master;
 }
 
+gint
+gtk_html_print_get_pages_num (GtkHTML *html, GnomePrintContext *print_context, gdouble header_height, gdouble footer_height)
+{
+	return html_engine_print_get_pages_num (html->engine, print_context, header_height, footer_height);
+}
+#endif /*DISABLE_PRINTING*/
+
+
 void
 gtk_html_images_ref (GtkHTML *html)
 {
@@ -5787,12 +5804,6 @@
 	html->engine->block_images = block;
 }
 
-gint
-gtk_html_print_get_pages_num (GtkHTML *html, GnomePrintContext *print_context, gdouble header_height, gdouble footer_height)
-{
-	return html_engine_print_get_pages_num (html->engine, print_context, header_height, footer_height);
-}
-
 gboolean
 gtk_html_has_undo (GtkHTML *html)
 {
diff -Nru gtkhtml-3.9.1/src/gtkhtml-embedded.c gtkhtml-3.9.1-djcb/src/gtkhtml-embedded.c
--- gtkhtml-3.9.1/src/gtkhtml-embedded.c	2002-11-05 21:39:01.000000000 +0200
+++ gtkhtml-3.9.1-djcb/src/gtkhtml-embedded.c	2005-11-09 19:45:56.000000000 +0200
@@ -22,7 +22,10 @@
  */
 
 #include <config.h>
+
+#ifndef DISABLE_GNOME
 #include <gnome.h>
+#endif /*DISABLE_GNOME*/
 
 #include "gtkhtml-embedded.h"
 #include "htmlengine.h"
@@ -120,7 +123,9 @@
 	gtk_html_embedded_changed(GTK_HTML_EMBEDDED(container));
 }
 
+#ifndef DISABLE_PRINTING
 typedef void (*draw_print_signal)(GtkObject *, gpointer, gpointer);
+#endif /*DISABLE_PRINTING*/
 typedef void (*draw_gdk_signal)(GtkObject *, gpointer, gpointer, gint, gint, gpointer);
 
 static void 
@@ -189,7 +194,7 @@
 			      draw_gdk_signal_marshaller, G_TYPE_NONE, 4,
 			      G_TYPE_POINTER, G_TYPE_POINTER,
 			      G_TYPE_INT, G_TYPE_INT);
-	
+#ifndef DISABLE_PRINTING	
 	signals [DRAW_PRINT] = 
 		g_signal_new ("draw_print",
 			      G_TYPE_FROM_CLASS (object_class),
@@ -199,7 +204,7 @@
 			      g_cclosure_marshal_VOID__POINTER,
 			      G_TYPE_NONE, 1,
 			      G_TYPE_POINTER);
-	
+#endif /*DISABLE_PRINTING*/
 	gobject_class->finalize = gtk_html_embedded_finalize;
 
 	widget_class->size_request = gtk_html_embedded_size_request;
diff -Nru gtkhtml-3.9.1/src/gtkhtml-embedded.h gtkhtml-3.9.1-djcb/src/gtkhtml-embedded.h
--- gtkhtml-3.9.1/src/gtkhtml-embedded.h	2002-11-05 21:39:01.000000000 +0200
+++ gtkhtml-3.9.1-djcb/src/gtkhtml-embedded.h	2005-11-09 19:44:30.000000000 +0200
@@ -56,7 +56,10 @@
         void (*changed)(GtkHTMLEmbedded *);
         void (*draw_gdk)(GtkHTMLEmbedded *, GdkPixmap *, GdkGC *,
                          gint, gint);
-        void (*draw_print)(GtkHTMLEmbedded *, GnomePrintContext *);
+
+#ifndef DISABLE_PRINTING
+	void (*draw_print)(GtkHTMLEmbedded *, GnomePrintContext *);
+#endif /*DISABLE_PRINTING*/
 };
 
 /* FIXME: There needs to be a way for embedded objects in forms to encode
diff -Nru gtkhtml-3.9.1/src/gtkhtml.h gtkhtml-3.9.1-djcb/src/gtkhtml.h
--- gtkhtml-3.9.1/src/gtkhtml.h	2005-07-06 13:34:19.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/gtkhtml.h	2005-11-09 19:50:59.000000000 +0200
@@ -25,8 +25,11 @@
 #include <sys/types.h>
 #include <gtk/gtklayout.h>
 #include <gtk/gtkbindings.h>
+
+#ifndef DISABLE_PRINTING
 #include <libgnomeprint/gnome-print.h>
 #include <libgnomeprint/gnome-print-job.h>
+#endif /*DISABLE_PRINTING*/
 
 #include "gtkhtml-types.h"
 #include "gtkhtml-enums.h"
@@ -214,6 +217,8 @@
 								   gboolean                   animate);
 gboolean                   gtk_html_get_animate                   (const GtkHTML             *html);
 
+#ifndef DISABLE_PRINTING
+
 /* Printing support.  */
 void                       gtk_html_print_with_header_footer      (GtkHTML                   *html,
 								   GnomePrintContext         *print_context,
@@ -230,6 +235,7 @@
 								   gdouble                    footer_height);
 void                       gtk_html_print_set_master              (GtkHTML                   *html,
 								   GnomePrintJob             *print_master);
+#endif /*DISABLE_PRINTING*/
 
 /* Title.  */
 const gchar               *gtk_html_get_title                     (GtkHTML                   *html);
diff -Nru gtkhtml-3.9.1/src/gtkhtml-private.h gtkhtml-3.9.1-djcb/src/gtkhtml-private.h
--- gtkhtml-3.9.1/src/gtkhtml-private.h	2005-09-11 07:05:25.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/gtkhtml-private.h	2005-11-09 19:58:19.000000000 +0200
@@ -22,8 +22,11 @@
 #ifndef _GTKHTML_PRIVATE_H
 #define _GTKHTML_PRIVATE_H
 
+#ifndef DISABLE_PRINTING
 #include <libgnomeprint/gnome-print.h>
 #include <libgnomeprint/gnome-print-job.h>
+#endif /*DISABLE_PRINTING*/
+
 #include <gtk/gtkimcontext.h>
 #include <gtk/gtkwidget.h>
 #include "gtkhtml-types.h"
@@ -46,9 +49,9 @@
 	char  *base_url;
 
 	GtkWidget *search_input_line;
-
+#ifndef DISABLE_PRINTING
 	GnomePrintJob *print_master;
-
+#endif /*DISABLE_PRINTING */
 	guint notify_spell_id;
 	guint notify_monospace_font_id;
 
diff -Nru gtkhtml-3.9.1/src/gtkhtml-types.h gtkhtml-3.9.1-djcb/src/gtkhtml-types.h
--- gtkhtml-3.9.1/src/gtkhtml-types.h	2001-08-29 10:16:12.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/gtkhtml-types.h	2005-11-09 19:43:28.000000000 +0200
@@ -23,7 +23,10 @@
 #ifndef _GTK_HTML_TYPES_H_
 #define _GTK_HTML_TYPES_H_
 
+#ifndef DISABLE_PRINTING
 #include <libgnomeprint/gnome-print.h>
+#endif /*DISABLE_PRINTING */
+
 #include "gtkhtml-enums.h"
 
 typedef struct _GtkHTML GtkHTML;
@@ -51,8 +54,9 @@
 					      const gchar *data,
 					      size_t       len,
 					      gpointer     user_data);
-
+#ifndef DISABLE_PRINTING
 typedef void (*GtkHTMLPrintCallback) (GtkHTML *html, GnomePrintContext *print_context,
 				      gdouble x, gdouble y, gdouble width, gdouble height, gpointer user_data);
+#endif /*DISABLE_PRINTING*/
 
 #endif
diff -Nru gtkhtml-3.9.1/src/htmlengine.c gtkhtml-3.9.1-djcb/src/htmlengine.c
--- gtkhtml-3.9.1/src/htmlengine.c	2005-09-11 07:05:25.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmlengine.c	2005-11-10 20:37:16.000000000 +0200
@@ -54,7 +54,11 @@
 #include "htmlengine-edit-movement.h"
 #include "htmlengine-edit-cut-and-paste.h"
 #include "htmlengine-edit-selection-updater.h"
+
+#ifndef DISABLE_PRINTING
 #include "htmlengine-print.h"
+#endif /*DISABLE_PRINTING*/
+
 #include "htmlcolor.h"
 #include "htmlinterval.h"
 #include "htmlobject.h"
@@ -4190,9 +4194,9 @@
 
 	engine->search_info = NULL;
 	engine->need_spell_check = FALSE;
-
+#ifndef DISABLE_PRINTING
 	html_engine_print_set_min_split_index (engine, .75);
-
+#endif /*DISABLE_PRINTING*/
 	engine->block = FALSE;
 	engine->block_images = FALSE;
 	engine->save_data = FALSE;
diff -Nru gtkhtml-3.9.1/src/htmlengine-print.c gtkhtml-3.9.1-djcb/src/htmlengine-print.c
--- gtkhtml-3.9.1/src/htmlengine-print.c	2005-05-17 17:47:36.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmlengine-print.c	2005-11-09 20:16:40.000000000 +0200
@@ -20,6 +20,9 @@
 */
 
 #include <config.h>
+
+#ifndef DISABLE_PRINTING
+
 #include <gtk/gtk.h>
 #include <glib/gi18n-lib.h>
 #include <libgnomeui/gnome-dialog-util.h>
@@ -228,3 +231,5 @@
 {
 	e->min_split_index = idx;
 }
+
+#endif /*DISABLE_PRINTING*/
diff -Nru gtkhtml-3.9.1/src/htmlengine-print.h gtkhtml-3.9.1-djcb/src/htmlengine-print.h
--- gtkhtml-3.9.1/src/htmlengine-print.h	2002-01-29 01:28:15.000000000 +0200
+++ gtkhtml-3.9.1-djcb/src/htmlengine-print.h	2005-11-09 19:59:37.000000000 +0200
@@ -22,6 +22,8 @@
 #ifndef _HTMLENGINE_PRINT_H
 #define _HTMLENGINE_PRINT_H
 
+#ifndef DISABLE_PRINTING
+
 #include <libgnomeprint/gnome-print.h>
 #include "htmlengine.h"
 
@@ -40,4 +42,7 @@
 					     gdouble               footer_height);
 void  html_engine_print_set_min_split_index (HTMLEngine           *e,
 					     gdouble               idx);
+
+#endif /*DISABLE_PRINTING*/
+
 #endif
diff -Nru gtkhtml-3.9.1/src/htmlframe.c gtkhtml-3.9.1-djcb/src/htmlframe.c
--- gtkhtml-3.9.1/src/htmlframe.c	2004-07-22 16:15:14.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmlframe.c	2005-11-09 20:46:46.000000000 +0200
@@ -168,6 +168,7 @@
 	HTMLEngine   *e       = GTK_HTML (frame->html)->engine;
 	GdkRectangle paint;
 
+#ifndef DISABLE_PRINTING
 	if (GTK_OBJECT_TYPE (e->painter) == HTML_TYPE_PRINTER) {
 		gint pixel_size = html_painter_get_pixel_size (e->painter);
 
@@ -180,6 +181,7 @@
 				  height - pixel_size * (html_engine_get_top_border (e) + html_engine_get_bottom_border (e)),
 				  tx + pixel_size * html_engine_get_left_border (e), ty + pixel_size * html_engine_get_top_border (e));
 	} else
+#endif /*DISABLE_PRINTING*/
 		(*HTML_OBJECT_CLASS (parent_class)->draw) (o, p, x, y, width, height, tx, ty);
 }
 
@@ -189,12 +191,17 @@
 	HTMLFrame *frame;
 
 	frame = HTML_FRAME (o);
-	if (G_OBJECT_TYPE (GTK_HTML (frame->html)->engine->painter) != HTML_TYPE_PRINTER) {
+#ifndef DISABLE_PRINTING
+	if (G_OBJECT_TYPE (GTK_HTML (frame->html)->engine->painter) != HTML_TYPE_PRINTER)
+#endif /*DISABLE_PRINTING*/
 		frame_set_gdk_painter (frame, GTK_HTML (frame->html)->engine->painter);
-	}
-	
+
+#ifdef DISABLE_PRINTING	
+	html_engine_set_painter (GTK_HTML (frame->html)->engine, frame->gdk_painter);
+#else	
 	html_engine_set_painter (GTK_HTML (frame->html)->engine,
 				 GTK_OBJECT_TYPE (painter) != HTML_TYPE_PRINTER ? frame->gdk_painter : painter);
+#endif /*DISABLE_PRINTING*/
 }
 
 static void
diff -Nru gtkhtml-3.9.1/src/htmliframe.c gtkhtml-3.9.1-djcb/src/htmliframe.c
--- gtkhtml-3.9.1/src/htmliframe.c	2005-05-05 14:21:47.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmliframe.c	2005-11-09 20:43:02.000000000 +0200
@@ -166,6 +166,7 @@
       gint width, gint height,
       gint tx, gint ty)
 {
+#ifndef DISABLE_PRINTING
 	HTMLIFrame   *iframe  = HTML_IFRAME (o);
 	HTMLEngine   *e       = GTK_HTML (iframe->html)->engine;
 	GdkRectangle paint;
@@ -182,6 +183,7 @@
 				  height - pixel_size * (html_engine_get_top_border (e) + html_engine_get_bottom_border (e)),
 				  tx + pixel_size * html_engine_get_left_border (e), ty + pixel_size * html_engine_get_top_border (e));
 	} else
+#endif /*DISABLE_PRINTING*/
 		(*HTML_OBJECT_CLASS (parent_class)->draw) (o, p, x, y, width, height, tx, ty);
 }
 
@@ -191,12 +193,17 @@
 	HTMLIFrame *iframe;
 
 	iframe = HTML_IFRAME (o);
-	if (G_OBJECT_TYPE (GTK_HTML (iframe->html)->engine->painter) != HTML_TYPE_PRINTER) {
+#ifndef DISABLE_PRINTING
+	if (G_OBJECT_TYPE (GTK_HTML (iframe->html)->engine->painter) != HTML_TYPE_PRINTER) 
+#endif /*DISABLE_PRINTING*/
 		iframe_set_gdk_painter (iframe, GTK_HTML (iframe->html)->engine->painter);
-	}
-	
+
+#ifdef DISABLE_PRINTING	
+	html_engine_set_painter (GTK_HTML (iframe->html)->engine, iframe->gdk_painter);
+#else
 	html_engine_set_painter (GTK_HTML (iframe->html)->engine,
 				 G_OBJECT_TYPE (painter) != HTML_TYPE_PRINTER ? iframe->gdk_painter : painter);
+#endif /*DISABLE_PRINTING*/
 }
 
 static void
diff -Nru gtkhtml-3.9.1/src/htmlimage.c gtkhtml-3.9.1-djcb/src/htmlimage.c
--- gtkhtml-3.9.1/src/htmlimage.c	2005-07-13 13:19:32.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmlimage.c	2005-11-11 12:44:59.000000000 +0200
@@ -391,10 +391,11 @@
 		e = html_object_engine (HTML_OBJECT (image), GTK_HTML (painter->widget)->engine);
 	else
 		return;
-
+	
+#ifndef DISABLE_PRINTING
 	if (HTML_IS_PRINTER (painter))
 		return;
-	
+#endif /*DISABLE_PRINTING*/
 	p = HTML_GDK_PAINTER (painter);
 	/* printf ("draw_image_focus\n"); */
 
diff -Nru gtkhtml-3.9.1/src/htmlprinter.c gtkhtml-3.9.1-djcb/src/htmlprinter.c
--- gtkhtml-3.9.1/src/htmlprinter.c	2005-10-22 13:25:26.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmlprinter.c	2005-11-11 12:45:20.000000000 +0200
@@ -20,6 +20,9 @@
 */
 
 #include <config.h>
+
+#ifndef DISABLE_PRINTING
+
 #include "gtkhtml-compat.h"
 
 #include <string.h>
@@ -850,3 +853,5 @@
 	printer->scale = scale;
 	painter->engine_to_pango = scale * PANGO_SCALE / 1024.;
 }
+
+#endif /*DISABLE_PRINTING*/
diff -Nru gtkhtml-3.9.1/src/htmlprinter.h gtkhtml-3.9.1-djcb/src/htmlprinter.h
--- gtkhtml-3.9.1/src/htmlprinter.h	2004-11-10 19:23:42.000000000 +0200
+++ gtkhtml-3.9.1-djcb/src/htmlprinter.h	2005-11-11 12:48:02.000000000 +0200
@@ -22,6 +22,8 @@
 #ifndef _HTMLPRINTER_H
 #define _HTMLPRINTER_H
 
+#ifndef DISABLE_PRINTING
+
 #include <libgnomeprint/gnome-print.h>
 #include <libgnomeprint/gnome-print-job.h>
 #include <libgnomeprint/gnome-print-config.h>
@@ -69,4 +71,5 @@
 void         html_printer_set_scale                   (HTMLPrinter       *printer,
 						       gdouble            scale);
 
+#endif /* DISABLE_PRINTING */
 #endif /* _HTMLPRINTER_H */
diff -Nru gtkhtml-3.9.1/src/htmltextslave.c gtkhtml-3.9.1-djcb/src/htmltextslave.c
--- gtkhtml-3.9.1/src/htmltextslave.c	2005-05-03 14:09:58.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmltextslave.c	2005-11-11 12:43:07.000000000 +0200
@@ -862,10 +862,10 @@
 		e = html_object_engine (HTML_OBJECT (slave->owner), GTK_HTML (painter->widget)->engine);
 	else
 		return;
-
+#ifndef DISABLE_PRINTING
 	if (HTML_IS_PRINTER (painter))
 		return;
-	
+#endif /*DISABLE_PRINTING*/	
 	p = HTML_GDK_PAINTER (painter);
 	/* printf ("draw_text_focus\n"); */
 
diff -Nru gtkhtml-3.9.1/src/htmltokenizer.c gtkhtml-3.9.1-djcb/src/htmltokenizer.c
--- gtkhtml-3.9.1/src/htmltokenizer.c	2004-05-13 18:07:33.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/htmltokenizer.c	2005-11-09 20:37:35.000000000 +0200
@@ -26,7 +26,11 @@
 #include <config.h>
 #include <ctype.h>
 #include <string.h>
+
+#ifndef DISABLE_GNOME
 #include <gnome.h>
+#endif /*DISABLE_GNOME*/
+
 #include "htmltokenizer.h"
 #include "htmlentity.h"
 
@@ -261,10 +265,10 @@
 	t->priv = NULL;
 }
 
-GtkType
+GType
 html_tokenizer_get_type (void)
 {
-	static GtkType html_tokenizer_type = 0;
+	static GType html_tokenizer_type = 0;
 
 	if (!html_tokenizer_type) {
 		static const GTypeInfo html_tokenizer_info = {
diff -Nru gtkhtml-3.9.1/src/libgtkhtml.pc.in gtkhtml-3.9.1-djcb/src/libgtkhtml.pc.in
--- gtkhtml-3.9.1/src/libgtkhtml.pc.in	2004-10-01 08:28:55.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/libgtkhtml.pc.in	2005-11-11 12:19:08.000000000 +0200
@@ -10,4 +10,4 @@
 Requires: @GTKHTML_MODULES@
 Version: @VERSION@
 Libs: -L${libdir} -lgtkhtml-@GTKHTML_API_VERSION@
-Cflags: -I${includedir}/libgtkhtml-@GTKHTML_API_VERSION@
+Cflags: -I${includedir}/libgtkhtml-@GTKHTML_API_VERSION@ @PC_CFLAGS@
diff -Nru gtkhtml-3.9.1/src/Makefile.am gtkhtml-3.9.1-djcb/src/Makefile.am
--- gtkhtml-3.9.1/src/Makefile.am	2005-08-24 05:58:40.000000000 +0300
+++ gtkhtml-3.9.1-djcb/src/Makefile.am	2005-11-10 19:48:02.000000000 +0200
@@ -32,6 +32,7 @@
         -DGNOMELOCALEDIR=\""$(prefix)/$(DATADIRNAME)/locale"\"
 #	-DGTK_DISABLE_DEPRECATED=1
 
+
 lib_LTLIBRARIES = libgtkhtml-3.8.la
 
 libgtkhtmldir = $(includedir)/libgtkhtml-@GTKHTML_API_VERSION@/gtkhtml
@@ -207,7 +208,7 @@
 	$(NULL)
 
 libgtkhtml_3_8_la_LDFLAGS = -version-info $(GTKHTML_CURRENT):$(GTKHTML_REVISION):$(GTKHTML_AGE) -no-undefined
-libgtkhtml_3_8_la_LIBADD = $(GTKHTML_LIBS) ../a11y/libgtkhtml-a11y.la $(GAIL_LIBS) $(REGEX_LIBS)
+libgtkhtml_3_8_la_LIBADD = $(GTKHTML_LIBS) $(A11Y_LA) $(GAIL_LIBS) $(REGEX_LIBS)
 
 dist-hook:
 	mkdir $(distdir)/tests
@@ -217,7 +218,13 @@
 if HAVE_SOUP
 test_programs = testgtkhtml
 endif
-noinst_PROGRAMS = $(test_programs) gtest test-suite test-stress
+
+if HAVE_PRINTING
+gnome_test_programs = gtest test-suite test-stress
+endif
+
+
+noinst_PROGRAMS = $(test_programs) $(gnome_test_programs) 
 
 testgtkhtml_SOURCES = 		\
 	testgtkhtml.c		\
